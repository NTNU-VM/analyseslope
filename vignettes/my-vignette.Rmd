---
title: "Vignette for R-package analyseslope"
author: "Sam Perrin"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Slope_Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  error=TRUE,
  collapse = TRUE,
  comment = "#>"
)
library(pool)
library(dplyr)
library(dbplyr)
library(postGIStools)
library(RPostgreSQL)
library(rstudioapi)
library(R2jags)


database <- 'nofa'
server <- "vm-srv-finstad.vm.ntnu.no"
```

The analyseslope package has been created to make it easy to derive and then analyse the effects of slope parameters between two connected lakes on the presence of a fish species in an upstream lake. 

At present, this package has only been developed to analyse perch in a selected few lakes across Sweden, however with influx of new data and work on other species presence, this will hopefully eventually be expanded to include more species across more of Scandinavia.

## Package run-through

Let's start with the most basic function, the `slope_dbconnect` function.

*Note: For privcay's sake I've already imported our database and server's names earlier.*

``` {r slope_connect, echo=FALSE}
source("../R/slope_dbconnect.R")
con <- slope_dbconnect(database, server)
```

All you need to do here is initiate the connection with our database on the server. This intiates all of the links that will be used in our next function, `extract_slope_params`. Ideally this function will be made more flexible in the future.

``` {r extract_slope_params, echo=FALSE}
source("../R/extract_slope_params.R")

connectivity_raw <- read.csv(file="../Data/sweden_connections.csv",sep=',',header=T)
connectivity <- connectivity_raw %>% 
  filter(!is.na(Present))

slope_table <- extract_slope_params(c("upstream_lakes","upstream_lakes_slope_max_max","upstream_lakes_slope_perc_90"), connectivity, con)
print(slope_table)
## Styles
```

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
